<!DOCTYPE html>
<html>
<head>
    <title>Smart Link Test</title>
</head>
<body>
    <p>You are being processed...</p>
    <p id="info"></p>
</body>

<script>
  const params = new URLSearchParams(window.location.search);
  const userID = params.get('uid') || "none";

  function getDeviceType() {
    const ua = navigator.userAgent;
    if (/android/i.test(ua)) return "Android";
    if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) return "iOS";
    return "Desktop";
  }

  async function getCountry() {
    try {
      // ðŸŽ¯ One call to YOUR Worker - no CORS, no rate limits, no API keys
      const res = await fetch("https://royal-pond-c748.elyakoubiayman1.workers.dev");
      const data = await res.json();
      return data.country || "UNKNOWN";
    } catch (err) {
      console.error("Geo lookup failed:", err);
      return "UNKNOWN";
    }
  }

  async function main() {
    const device = getDeviceType();
    const country = await getCountry();
    
    console.log("Device:", device);
    console.log("Country:", country);
    
    document.getElementById("info").innerText = 
      `Device: ${device}\nCountry: ${country}`;
  }

  main();
</script>
</html>